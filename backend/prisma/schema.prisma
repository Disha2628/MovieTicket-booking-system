generator client {
  provider = "prisma-client-js"
  output   = "../src/generated"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Movie {
  Movie_Id     Int           @id @default(autoincrement())
  Title        String        @db.VarChar(150)
  Genre        String?       @db.VarChar(50)
  Language     String?       @db.VarChar(50)
  Duration     Int?
  Trailer_URL  String?       @db.VarChar(255)
  Rating       Float?        @db.Float
  Description  String?       @db.Text
  Release_date DateTime?     @db.Date
  Poster_url   String?       @db.VarChar(255)
  movie_actors Movie_Actor[]
  reviews      Review[]
  shows        Show[]

  @@map("movies")
}

model Actor {
  Actor_Id     Int           @id @default(autoincrement())
  Name         String        @db.VarChar(100)
  Created_At   DateTime?     @default(now()) @db.Timestamp(0)
  actor_pic    String?       @db.VarChar(255)
  movie_actors Movie_Actor[]

  @@map("actors")
}

model Movie_Actor {
  movie_Id  Int
  Actor_Id  Int
  Role_Name String? @db.VarChar(100)
  movies    Movie   @relation(fields: [movie_Id], references: [Movie_Id], onDelete: Cascade, onUpdate: NoAction, map: "movie_actors_ibfk_1")
  actor     Actor   @relation(fields: [Actor_Id], references: [Actor_Id], onDelete: Cascade, onUpdate: NoAction, map: "movie_actors_ibfk_2")

  @@id([movie_Id, Actor_Id])
  @@index([Actor_Id], map: "Actor_Id")
  @@map("movie_actors")
}

model Screen {
  screen_no        Int
  theatre_Id       Int
  Screen_name      String? @db.VarChar(50)
  No_of_seats      Int?
  Layout_structure Json?
  theatre          theatre @relation(fields: [theatre_Id], references: [theatre_Id], onDelete: NoAction, onUpdate: NoAction, map: "screens_ibfk_1")
  shows            Show[]

  @@id([screen_no, theatre_Id])
  @@index([theatre_Id], map: "theatre_Id")
  @@map("screens")
}

model Show {
  Show_Id        Int                  @id @default(autoincrement())
  Movie_Id       Int
  Theatre_Id     Int
  Screen_no      Int
  Show_date      DateTime             @db.Date
  Start_time     DateTime             @db.Time(0)
  Show_dimension shows_Show_dimension
  available_seats Int?                @default(0)
  booking        booking[]
  seats          Seat[]
  movie          Movie                @relation(fields: [Movie_Id], references: [Movie_Id], onDelete: NoAction, onUpdate: NoAction, map: "shows_ibfk_1")
  theatre        theatre              @relation(fields: [Theatre_Id], references: [theatre_Id], onDelete: NoAction, onUpdate: NoAction, map: "shows_ibfk_2")
  screens        Screen               @relation(fields: [Screen_no, Theatre_Id], references: [screen_no, theatre_Id], onDelete: NoAction, onUpdate: NoAction, map: "shows_ibfk_3")

  @@index([Movie_Id], map: "Movie_Id")
  @@index([Screen_no], map: "Screen_no")
  @@index([Theatre_Id], map: "Theatre_Id")
  @@map("shows")
}

model Seat {
  seat_id       Int             @id @default(autoincrement())
  show_id       Int
  seat_name     String          @db.VarChar(5)
  seat_type     String?         @db.VarChar(20)
  seat_price    Decimal?        @db.Decimal(10, 2)
  status        seats_status?   @default(available)
  booking_seats booking_seats[]
  shows         Show            @relation(fields: [show_id], references: [Show_Id], onDelete: NoAction, onUpdate: NoAction, map: "seats_ibfk_1")

  @@index([show_id], map: "show_id")
  @@map("seats")
}

model Review {
  Review_Id   Int       @id @default(autoincrement())
  movie_Id    Int?
  Rating      Int?
  Comment     String?   @db.Text
  Reviewed_At DateTime? @default(now()) @db.Timestamp(0)
  movies      Movie?    @relation(fields: [movie_Id], references: [Movie_Id], onDelete: Cascade, onUpdate: NoAction, map: "reviews_ibfk_1")

  @@index([movie_Id], map: "movie_Id")
  @@map("reviews")
}

model booking {
  booking_Id     Int             @id @default(autoincrement())
  customer_Id    Int?
  show_id        Int?
  Amount         Decimal         @db.Decimal(10, 2)
  Payment_method String?         @db.VarChar(50)
  Status         String          @default("pending") @db.VarChar(20)
  payment_time   DateTime?       @default(now()) @db.Timestamp(0)
  booking_qr     String?         @db.Text
  customer       customer?       @relation(fields: [customer_Id], references: [customer_Id], onDelete: NoAction, onUpdate: NoAction, map: "booking_ibfk_1")
  shows          Show?           @relation(fields: [show_id], references: [Show_Id], onDelete: NoAction, onUpdate: NoAction, map: "booking_ibfk_2")
  booking_seats  booking_seats[]

  @@index([customer_Id], map: "customer_Id")
  @@index([show_id], map: "show_id")
}

model booking_seats {
  booking_seat_id Int      @id @default(autoincrement())
  booking_Id      Int?
  seat_id         Int?
  booking         booking? @relation(fields: [booking_Id], references: [booking_Id], onDelete: NoAction, onUpdate: NoAction, map: "booking_seats_ibfk_1")
  seats           Seat?    @relation(fields: [seat_id], references: [seat_id], onDelete: NoAction, onUpdate: NoAction, map: "booking_seats_ibfk_2")

  @@unique([booking_Id, seat_id], map: "uk_booking_seat")
  @@index([seat_id], map: "seat_id")
}

model customer {
  customer_Id Int       @id @default(autoincrement())
  F_Name      String    @db.VarChar(50)
  L_Name      String    @db.VarChar(50)
  Email       String    @unique(map: "Email") @db.VarChar(100)
  Phone_No    BigInt    @unique(map: "Phone_No")
  Password    String    @db.VarChar(255)
  Created_at  DateTime? @default(now()) @db.DateTime(0)
  booking     booking[]
}

model theatre {
  theatre_Id          Int      @id @default(autoincrement())
  Name                String?  @db.VarChar(150)
  Total_no_of_screens Int?
  Address_Pincode     String?  @db.VarChar(10)
  Address_City        String?  @db.VarChar(50)
  Address_Area        String?  @db.VarChar(50)
  Address_Landmark    String?  @db.VarChar(100)
  Address_BuildingNo  String?  @db.VarChar(20)
  screens             Screen[]
  shows               Show[]
}

enum seats_status {
  available
  unavailable
}

enum shows_Show_dimension {
  D2 @map("2D")
  D3 @map("3D")
  D4 @map("4D")
}
